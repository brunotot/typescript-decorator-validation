"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.makeDecorator = void 0;
const MetadataProcessor_1 = __importDefault(require("../model/processor/MetadataProcessor"));
function isDecoratorsStage2(context) {
    return typeof context === "string";
}
function makeDecoratorUsingStage2Strategy(target, context, decoratorSupplier) {
    const name = context;
    const clazz = target.constructor;
    const processor = MetadataProcessor_1.default.fromClass(clazz);
    decoratorSupplier(name, processor, {
        name: name,
        metadata: {},
    });
}
function makeDecorator(decoratorSupplier) {
    return function (target, context) {
        // Hardcoded check for old TS decorators (stage 2 proposal)
        if (isDecoratorsStage2(context)) {
            return makeDecoratorUsingStage2Strategy(target, context, decoratorSupplier);
        }
        // Regular stage 3 syntax
        const name = context.name;
        const metadataProcessor = MetadataProcessor_1.default.fromContext(context);
        decoratorSupplier(name, metadataProcessor, context);
    };
}
exports.makeDecorator = makeDecorator;
